<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹ ê³  ìƒì„¸ - CODE-L ê´€ë¦¬ì</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f5f5f5; }

        /* ì‚¬ì´ë“œë°” */
        .sidebar { position: fixed; left: 0; top: 0; width: 250px; height: 100vh; background: #343a40; padding: 20px; overflow-y: auto; }
        .sidebar .brand { color: white; font-size: 20px; font-weight: bold; margin-bottom: 30px; display: block; text-decoration: none; }
        .sidebar .nav-item { margin-bottom: 10px; }
        .sidebar .nav-link { display: block; padding: 12px 15px; color: #fff; text-decoration: none; border-radius: 5px; transition: all 0.3s; }
        .sidebar .nav-link:hover { background: #495057; }
        .sidebar .nav-link.active { background: #495057; font-weight: 600; }
        .sidebar .nav-link i { margin-right: 10px; width: 20px; }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content { margin-left: 250px; padding: 30px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; margin-bottom: 20px; }

        .back-btn { display: inline-block; padding: 8px 16px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 5px; margin-bottom: 20px; }
        .back-btn:hover { background-color: #5a6268; }

        .alert { padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        .alert-success { background-color: #d1e7dd; color: #0f5132; }
        .alert-error { background-color: #f8d7da; color: #842029; }

        .detail-section { background-color: #f8f9fa; padding: 25px; border-radius: 8px; margin-bottom: 20px; }
        .detail-section h2 { font-size: 18px; margin-bottom: 20px; color: #333; padding-bottom: 10px; border-bottom: 2px solid #dee2e6; }
        .detail-grid { display: grid; grid-template-columns: 150px 1fr; gap: 15px; }
        .detail-label { font-weight: 600; color: #666; }
        .detail-value { color: #333; }

        .status-badge { display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; }
        .status-pending { background-color: #fff3cd; color: #856404; }
        .status-in-progress { background-color: #cfe2ff; color: #084298; }
        .status-resolved { background-color: #d1e7dd; color: #0f5132; }
        .status-dismissed { background-color: #e2e3e5; color: #41464b; }
        .status-duplicate { background-color: #f8d7da; color: #842029; }

        .member-card { background: white; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6; }
        .member-card h3 { font-size: 16px; margin-bottom: 10px; color: #333; }
        .member-info { display: grid; gap: 8px; }
        .member-info-item { display: flex; gap: 10px; }
        .member-info-label { font-weight: 600; color: #666; min-width: 80px; }

        .reason-box { background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #dc3545; white-space: pre-wrap; word-break: break-word; line-height: 1.6; }

        .action-section { background-color: #fff; padding: 25px; border-radius: 8px; border: 2px solid #007bff; }
        .action-section h2 { font-size: 18px; margin-bottom: 20px; color: #007bff; }
        .action-buttons { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .action-btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; }
        .btn-resolve { background-color: #28a745; color: white; } .btn-resolve:hover { background-color: #218838; }
        .btn-dismiss { background-color: #6c757d; color: white; } .btn-dismiss:hover { background-color: #5a6268; }

        .note-form { margin-top: 15px; }
        .note-form textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; resize: vertical; min-height: 80px; }
        .note-form button { margin-top: 10px; padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }

        .history-section { margin-top: 30px; }
        .history-section h2 { font-size: 18px; margin-bottom: 15px; color: #333; }
        .history-table { width: 100%; border-collapse: collapse; background: white; }
        .history-table th { background-color: #f8f9fa; padding: 12px; text-align: left; font-weight: 600; border-bottom: 2px solid #dee2e6; font-size: 13px; }
        .history-table td { padding: 12px; border-bottom: 1px solid #dee2e6; font-size: 14px; }
        .history-table tr:hover { background-color: #f8f9fa; }

        .total-count { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 15px; }
        .total-count .number { font-size: 32px; font-weight: bold; }
        .total-count .label { font-size: 14px; opacity: 0.9; margin-top: 5px; }
    </style>
</head>
<body>
<!-- ì‚¬ì´ë“œë°” -->
<nav class="sidebar">
    <a href="/v1/admin/home" class="brand">
        <i class="fa-solid fa-user-shield"></i> code:L ê´€ë¦¬ì
    </a>
    <ul style="list-style: none; padding: 0;">
        <li class="nav-item">
            <a class="nav-link" href="/v1/admin/home">
                <i class="fa-solid fa-gauge"></i> ëŒ€ì‹œë³´ë“œ
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/v1/admin/members">
                <i class="fa-solid fa-users"></i> íšŒì› ê´€ë¦¬
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/v1/admin/questions">
                <i class="fa-solid fa-circle-question"></i> ì§ˆë¬¸ ê´€ë¦¬
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="/v1/admin/reports">
                <i class="fa-solid fa-flag"></i> ì‹ ê³  ê´€ë¦¬
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/v1/admin/verification-images">
                <i class="fa-solid fa-image"></i> í‘œì¤€ ì¸ì¦ ì´ë¯¸ì§€ ê´€ë¦¬
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/v1/admin/kpi">
                <i class="fa-solid fa-chart-bar"></i> KPI ëŒ€ì‹œë³´ë“œ
            </a>
        </li>
    </ul>
</nav>

<!-- ë©”ì¸ ì»¨í…ì¸  -->
<div class="main-content">
    <div class="container">
        <a href="/v1/admin/reports" class="back-btn">â† ì‹ ê³  ëª©ë¡ìœ¼ë¡œ</a>
        <h1>ğŸš¨ ì‹ ê³  ìƒì„¸ ì •ë³´</h1>

        <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

        <!-- ì‹ ê³  ê¸°ë³¸ ì •ë³´ -->
        <div class="detail-section">
            <h2>ğŸ“‹ ì‹ ê³  ê¸°ë³¸ ì •ë³´</h2>
            <div class="detail-grid">
                <div class="detail-label">ì‹ ê³  ID</div>
                <div class="detail-value" th:text="${report.id}">1</div>

                <div class="detail-label">ì‹ ê³  ì¼ì‹œ</div>
                <div class="detail-value" th:text="${#temporals.format(report.createdAt, 'yyyy-MM-dd HH:mm:ss')}">2025-01-01 12:00:00</div>

                <div class="detail-label">ì²˜ë¦¬ ìƒíƒœ</div>
                <div class="detail-value">
                    <span class="status-badge" th:classappend="${'status-' + #strings.toLowerCase(report.status.name().replace('_', '-'))}" th:text="${report.status.description}">ë¯¸ì²˜ë¦¬</span>
                </div>

                <div class="detail-label">ì²˜ë¦¬ ì¼ì‹œ</div>
                <div class="detail-value" th:text="${report.processedAt != null ? #temporals.format(report.processedAt, 'yyyy-MM-dd HH:mm:ss') : '-'}">-</div>
            </div>
        </div>

        <!-- ì‹ ê³ ì & í”¼ì‹ ê³ ì ì •ë³´ -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div class="member-card">
                <h3>ğŸ‘¤ ì‹ ê³ ì</h3>
                <div class="member-info">
                    <div class="member-info-item">
                        <span class="member-info-label">ID</span>
                        <span th:text="${report.reporter.id}">1</span>
                    </div>
                    <div class="member-info-item">
                        <span class="member-info-label">ì½”ë“œë„¤ì„</span>
                        <span th:text="${report.reporter.profile?.codeName ?: '-'}">-</span>
                    </div>
                    <div class="member-info-item">
                        <span class="member-info-label">ì´ë©”ì¼</span>
                        <span th:text="${report.reporter.email}">email</span>
                    </div>
                    <div class="member-info-item">
                        <a th:href="@{/v1/admin/member/{id}(id=${report.reporter.id})}" style="color: #007bff; text-decoration: none;">ìƒì„¸ í”„ë¡œí•„ ë³´ê¸° â†’</a>
                    </div>
                </div>
            </div>

            <div class="member-card" style="border-left: 4px solid #dc3545;">
                <h3>ğŸ¯ í”¼ì‹ ê³ ì</h3>
                <div class="member-info">
                    <div class="member-info-item">
                        <span class="member-info-label">ID</span>
                        <span th:text="${report.reported.id}">2</span>
                    </div>
                    <div class="member-info-item">
                        <span class="member-info-label">ì½”ë“œë„¤ì„</span>
                        <span th:text="${report.reported.profile?.codeName ?: '-'}">-</span>
                    </div>
                    <div class="member-info-item">
                        <span class="member-info-label">ì´ë©”ì¼</span>
                        <span th:text="${report.reported.email}">email</span>
                    </div>
                    <div class="member-info-item">
                        <a th:href="@{/v1/admin/member/{id}(id=${report.reported.id})}" style="color: #007bff; text-decoration: none;">ìƒì„¸ í”„ë¡œí•„ ë³´ê¸° â†’</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì‹ ê³  ì‚¬ìœ  -->
        <div class="detail-section">
            <h2>ğŸ’¬ ì‹ ê³  ì‚¬ìœ </h2>
            <div class="reason-box" th:text="${report.reason}">ì‹ ê³  ì‚¬ìœ  ë‚´ìš©</div>
        </div>

        <!-- ê´€ë¦¬ì ë©”ëª¨ -->
        <div class="detail-section" th:if="${report.adminNote != null}">
            <h2>ğŸ“ ê´€ë¦¬ì ë©”ëª¨</h2>
            <div style="background: white; padding: 15px; border-radius: 5px;" th:text="${report.adminNote}">ê´€ë¦¬ì ë©”ëª¨</div>
        </div>

        <!-- ì¡°ì¹˜ íŒ¨ë„ -->
        <div class="action-section">
            <h2>âš–ï¸ ì‹ ê³  ì²˜ë¦¬</h2>
            <div class="action-buttons">
                <form th:action="@{/v1/admin/reports/{id}/resolve(id=${report.id})}" method="post" style="display: inline;">
                    <button type="submit" class="action-btn btn-resolve" onclick="return confirm('ì´ ì‹ ê³ ë¥¼ ì²˜ë¦¬ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">âœ“ ì²˜ë¦¬ ì™„ë£Œ</button>
                </form>
                <form th:action="@{/v1/admin/reports/{id}/dismiss(id=${report.id})}" method="post" style="display: inline;">
                    <button type="submit" class="action-btn btn-dismiss" onclick="return confirm('ì´ ì‹ ê³ ë¥¼ ë°˜ë ¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">âœ— ë°˜ë ¤</button>
                </form>
            </div>

            <div class="note-form">
                <form th:action="@{/v1/admin/reports/{id}/status(id=${report.id})}" method="post">
                    <label style="font-weight: 600; margin-bottom: 10px; display: block;">ìƒíƒœ ë³€ê²½ ë° ë©”ëª¨ ì¶”ê°€</label>
                    <select name="status" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px;">
                        <option th:each="status : ${statuses}" th:value="${status.name()}" th:text="${status.description}" th:selected="${status == report.status}"></option>
                    </select>
                    <textarea name="note" placeholder="ê´€ë¦¬ì ë©”ëª¨ (ì„ íƒì‚¬í•­)" th:text="${report.adminNote}"></textarea>
                    <button type="submit">ì €ì¥</button>
                </form>
            </div>
        </div>

        <!-- í”¼ì‹ ê³ ì ì´ë ¥ -->
        <div class="history-section">
            <div class="total-count">
                <div class="number" th:text="${totalReportCount}">0</div>
                <div class="label">ì´ ì‚¬ìš©ìê°€ ë°›ì€ ì´ ì‹ ê³  íšŸìˆ˜</div>
            </div>

            <h2>ğŸ“Š í”¼ì‹ ê³ ìì˜ ê³¼ê±° ì‹ ê³  ì´ë ¥</h2>
            <table class="history-table">
                <thead>
                <tr><th>ì‹ ê³  ID</th><th>ì‹ ê³  ì¼ì‹œ</th><th>ì‹ ê³ ì</th><th>ì‹ ê³  ì‚¬ìœ </th><th>ì²˜ë¦¬ ìƒíƒœ</th></tr>
                </thead>
                <tbody>
                <tr th:if="${reportHistory.empty}"><td colspan="5" style="text-align: center; padding: 30px; color: #999;">ê³¼ê±° ì‹ ê³  ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                <tr th:each="history : ${reportHistory}">
                    <td><a th:href="@{/v1/admin/reports/{id}(id=${history.id})}" style="color: #007bff; text-decoration: none;" th:text="${history.id}">1</a></td>
                    <td th:text="${#temporals.format(history.createdAt, 'yyyy-MM-dd HH:mm')}">2025-01-01 12:00</td>
                    <td th:text="${history.reporter.profile?.codeName ?: history.reporter.email}">ì‹ ê³ ì</td>
                    <td><div style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" th:text="${history.reason}">ì‚¬ìœ </div></td>
                    <td><span class="status-badge" th:classappend="${'status-' + #strings.toLowerCase(history.status.name().replace('_', '-'))}" th:text="${history.status.description}">ìƒíƒœ</span></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
</html>